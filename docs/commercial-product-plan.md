# Claude Remote 商业化产品执行计划

## 项目概述

将 Telegram Bridge 改造为独立商业产品，支持用户通过手机/网页远程控制本地 Claude CLI。

```
目标用户：已安装 Claude Code CLI 的开发者
核心价值：随时随地远程编程
商业模式：订阅制
```

---

## 技术架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   Web App (PWA)              Relay Server              Desktop App      │
│   Next.js                    Node.js                   Electron         │
│   React + Tailwind           WebSocket                 跨平台           │
│        │                         │                         │            │
│        │◄────── WSS ────────────►│◄─────── WSS ───────────►│            │
│        │                         │                         │            │
│        │                    ┌────┴────┐                    │            │
│        │                    │ 用户认证 │                    │            │
│        │                    │ 设备配对 │               Claude CLI       │
│        │                    │ 消息路由 │                    │            │
│        │                    └─────────┘                    │            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 阶段规划

### Phase 0: 项目初始化
**目标：搭建开发环境和项目结构**

| 任务 | 产出 | 预估 |
|------|------|------|
| 创建 monorepo 项目结构 | `/packages/{relay,desktop,web}` | 2h |
| 配置 TypeScript + ESLint | 统一代码规范 | 1h |
| 配置 CI/CD | GitHub Actions | 1h |
| 申请域名 | claude-remote.com 或类似 | 1h |

**产出物：**
```
claude-remote/
├── packages/
│   ├── relay/          # 中继服务器
│   ├── desktop/        # Electron 桌面端
│   ├── web/            # Next.js 网页端
│   └── shared/         # 共享类型和工具
├── package.json        # workspace 配置
└── turbo.json          # monorepo 构建配置
```

---

### Phase 1: 中继服务器 MVP
**目标：实现核心消息转发功能**

#### 1.1 基础 WebSocket 服务
| 任务 | 说明 |
|------|------|
| WebSocket 服务器 | 基于 `ws` 库，支持多连接 |
| 连接管理 | 心跳检测、断线重连 |
| 房间机制 | 基于 pairId 的消息隔离 |

```typescript
// 核心接口
interface RelayServer {
  // 连接管理
  handleConnection(ws: WebSocket, token: string): void;
  handleDisconnect(token: string): void;

  // 消息路由
  routeMessage(from: string, message: Message): void;
}
```

#### 1.2 配对系统
| 任务 | 说明 |
|------|------|
| 配对码生成 | 8位随机码，5分钟过期 |
| 配对验证 | 匹配桌面端和手机端 |
| 令牌颁发 | 生成长期设备令牌 |

```typescript
// API 端点
POST /api/pair/request    // 桌面端请求配对码
POST /api/pair/confirm    // 手机端提交配对码
GET  /api/pair/status     // 查询配对状态

// WebSocket 消息类型
type WSMessage =
  | { type: 'auth', token: string }
  | { type: 'paired', pairId: string }
  | { type: 'message', payload: any }
  | { type: 'ping' } | { type: 'pong' }
```

#### 1.3 部署
| 任务 | 说明 |
|------|------|
| Fly.io 部署 | 单实例起步 |
| SSL 证书 | 自动 HTTPS |
| 环境变量 | 密钥管理 |

**Phase 1 完成标准：**
- [x] 两个 WebSocket 客户端可通过服务器互发消息
- [x] 配对码流程完整可用
- [ ] 部署到 Fly.io 可访问

---

### Phase 2: Electron 桌面端 MVP
**目标：替代当前 Node.js Bridge**

#### 2.1 基础框架
| 任务 | 说明 |
|------|------|
| Electron 项目初始化 | electron-forge 或 electron-builder |
| 系统托盘 | 菜单栏常驻图标 |
| 开机自启 | 可选配置 |

#### 2.2 配对界面
| 任务 | 说明 |
|------|------|
| 二维码生成 | 使用 `qrcode` 库 |
| 配对码显示 | 大字体易读 |
| 配对状态 | 等待/成功/失败 |

```
┌─────────────────────────────┐
│  Claude Remote         [—] │
├─────────────────────────────┤
│     ┌───────────────┐      │
│     │   QR CODE     │      │
│     └───────────────┘      │
│      ABCD-1234             │
│      ⏳ 等待配对 (4:32)     │
├─────────────────────────────┤
│  工作目录: ~/projects       │
│  状态: 已连接中继服务器      │
│  [设置] [退出]              │
└─────────────────────────────┘
```

#### 2.3 核心功能迁移
| 任务 | 说明 |
|------|------|
| 复用 SessionManager | 从现有 bridge 迁移 |
| 复用 ClaudeProcess | 从现有 bridge 迁移 |
| RelayClient | 连接中继服务器 |
| 消息桥接 | Relay ↔ Claude CLI |

```typescript
// 架构
class DesktopApp {
  relayClient: RelayClient;       // 连接中继
  sessionManager: SessionManager; // 管理 Claude 会话

  // 消息流
  // Relay -> SessionManager -> Claude CLI
  // Claude CLI -> SessionManager -> Relay
}
```

#### 2.4 Claude CLI 集成
| 任务 | 说明 |
|------|------|
| 自动检测 CLI | 查找已安装的 claude |
| 验证 CLI 登录 | 检查认证状态 |
| 错误处理 | CLI 未安装/未登录提示 |

#### 2.5 打包分发
| 任务 | 说明 |
|------|------|
| macOS 打包 | .dmg 安装包 |
| Windows 打包 | .exe 安装程序 |
| 自动更新 | electron-updater |

**Phase 2 完成标准：**
- [ ] macOS 可安装运行
- [ ] 显示二维码和配对码
- [ ] 成功与中继服务器通信
- [ ] Claude CLI 消息可双向传递

---

### Phase 3: Web 端 MVP
**目标：手机可访问的聊天界面**

#### 3.1 项目搭建
| 任务 | 说明 |
|------|------|
| Next.js 14 初始化 | App Router |
| Tailwind CSS | 样式框架 |
| PWA 配置 | 可添加到主屏幕 |

#### 3.2 配对页面
| 任务 | 说明 |
|------|------|
| 扫码功能 | 调用摄像头扫描 |
| 手动输入 | 配对码输入框 |
| 配对状态 | 连接中/成功/失败 |

```
/pair
┌─────────────────────────────┐
│  添加设备                   │
├─────────────────────────────┤
│  ┌───────────────────────┐ │
│  │    📷 扫描二维码       │ │
│  └───────────────────────┘ │
│         ── 或 ──           │
│  配对码: [____]-[____]     │
│  [连接]                     │
└─────────────────────────────┘
```

#### 3.3 聊天界面
| 任务 | 说明 |
|------|------|
| 消息列表 | 虚拟滚动，支持长消息 |
| 输入框 | 多行输入，发送按钮 |
| 代码高亮 | 使用 Prism/Shiki |
| Markdown | 渲染 Claude 响应 |

```
/chat
┌─────────────────────────────┐
│  [会话1 ▼]    [≡] 设置      │
├─────────────────────────────┤
│  ┌─────────────────────┐   │
│  │ 🤖 Claude           │   │
│  │ 我已经完成了...      │   │
│  │ ```typescript       │   │
│  │ function hello() {} │   │
│  │ ```                 │   │
│  └─────────────────────┘   │
│                             │
│  ┌─────────────────────┐   │
│  │ 👤 You              │   │
│  │ 帮我优化这个函数     │   │
│  └─────────────────────┘   │
├─────────────────────────────┤
│  [输入消息...]        [发送]│
└─────────────────────────────┘
```

#### 3.4 会话管理
| 任务 | 说明 |
|------|------|
| 会话列表 | 侧边栏显示 |
| 新建会话 | 指定名称和目录 |
| 切换会话 | 点击切换 |
| 关闭会话 | 滑动删除 |

#### 3.5 WebSocket 客户端
| 任务 | 说明 |
|------|------|
| 连接管理 | 自动重连 |
| 状态显示 | 连接/断开/重连中 |
| 消息队列 | 离线消息缓存 |

**Phase 3 完成标准：**
- [ ] 手机浏览器可访问
- [ ] 扫码/输入配对码连接
- [ ] 发送消息并收到 Claude 响应
- [ ] 基础会话管理

---

### Phase 4: 功能完善
**目标：完整可用的产品**

#### 4.1 用户体验优化
| 任务 | 说明 |
|------|------|
| 消息状态 | 发送中/已发送/失败 |
| 加载动画 | Claude 思考中效果 |
| 错误提示 | 友好的错误信息 |
| 断线提示 | 桌面端离线通知 |

#### 4.2 高级功能
| 任务 | 说明 |
|------|------|
| 文件发送 | 发送图片/文件到 Claude |
| 历史记录 | 本地存储聊天历史 |
| 搜索 | 搜索历史消息 |
| 导出 | 导出对话为 Markdown |

#### 4.3 设置页面
| 任务 | 说明 |
|------|------|
| 主题 | 亮色/暗色 |
| 通知 | 推送通知设置 |
| 设备管理 | 解除配对 |
| 关于 | 版本信息 |

**Phase 4 完成标准：**
- [ ] 完整的错误处理
- [ ] 基础文件发送
- [ ] 历史记录功能
- [ ] 设置页面

---

### Phase 5: 商业化
**目标：可收费的产品**

#### 5.1 用户系统
| 任务 | 说明 |
|------|------|
| 登录注册 | 邮箱/Google/GitHub |
| 用户数据库 | Supabase 或 Postgres |
| JWT 认证 | 安全的会话管理 |

#### 5.2 订阅系统
| 任务 | 说明 |
|------|------|
| Stripe 集成 | 支付处理 |
| 订阅计划 | 免费试用/月付/年付 |
| 付费墙 | 限制免费功能 |

```
免费版：
- 1 个设备配对
- 1 个会话
- 基础功能

Pro 版 ($9.9/月)：
- 无限设备
- 5 个并发会话
- 文件传输
- 历史记录
- 优先支持
```

#### 5.3 落地页
| 任务 | 说明 |
|------|------|
| 产品介绍 | 功能展示 |
| 定价页面 | 订阅计划对比 |
| 文档 | 使用指南 |

**Phase 5 完成标准：**
- [ ] 用户可注册登录
- [ ] Stripe 支付可用
- [ ] 订阅限制生效
- [ ] 落地页上线

---

### Phase 6: 发布与运营
**目标：正式上线**

#### 6.1 发布准备
| 任务 | 说明 |
|------|------|
| Beta 测试 | 邀请用户内测 |
| Bug 修复 | 处理反馈问题 |
| 性能优化 | 加载速度优化 |

#### 6.2 运营基础
| 任务 | 说明 |
|------|------|
| 数据分析 | Mixpanel/Amplitude |
| 错误监控 | Sentry |
| 客服渠道 | Discord/邮件 |

#### 6.3 推广
| 任务 | 说明 |
|------|------|
| Product Hunt | 发布 |
| 技术博客 | 使用教程 |
| 社交媒体 | Twitter/Reddit |

---

## 里程碑时间线

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  Phase 0        Phase 1        Phase 2        Phase 3        Phase 4   │
│  项目初始化      中继服务器      桌面端          Web端          功能完善   │
│     │              │              │              │              │       │
│     ▼              ▼              ▼              ▼              ▼       │
│  ┌─────┐       ┌─────┐       ┌─────┐       ┌─────┐       ┌─────┐      │
│  │ 1天 │──────►│ 3天 │──────►│ 5天 │──────►│ 5天 │──────►│ 5天 │      │
│  └─────┘       └─────┘       └─────┘       └─────┘       └─────┘      │
│                                                                         │
│  ════════════════════════════════════════════════════════════════      │
│                     MVP 完成（约 2-3 周）                                │
│                                                                         │
│                                                              Phase 5    │
│                                                              商业化     │
│                                                                 │       │
│                                                                 ▼       │
│                                                            ┌─────┐     │
│                                                            │ 1周 │     │
│                                                            └─────┘     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 技术栈总结

| 组件 | 技术选型 | 理由 |
|------|---------|------|
| **中继服务器** | Node.js + ws + Express | 复用现有代码，熟悉度高 |
| **桌面端** | Electron | 跨平台，复用 Node.js 代码 |
| **Web端** | Next.js 14 + Tailwind | 现代化，SSR，PWA 支持 |
| **数据库** | Supabase (Postgres) | 免费额度高，实时订阅 |
| **支付** | Stripe | 业界标准 |
| **部署** | Fly.io (服务器) + Vercel (Web) | 简单，成本低 |
| **监控** | Sentry + Mixpanel | 错误追踪 + 用户分析 |

---

## 风险与应对

| 风险 | 影响 | 应对 |
|------|------|------|
| Claude CLI 更新导致不兼容 | 高 | 监控更新，快速适配 |
| Anthropic 政策变化 | 高 | 关注官方动态，准备替代方案 |
| 用户增长超出服务器容量 | 中 | 设计可横向扩展架构 |
| 安全漏洞 | 高 | 代码审计，安全测试 |

---

## 下一步行动

**立即可开始：**
1. 创建新的 monorepo 项目
2. 开始 Phase 1 中继服务器开发
3. 同步设计 Electron 项目结构

**需要你决定：**
1. 产品名称：Claude Remote? 其他?
2. 域名：提前注册
3. 是否需要 Logo 设计

---

*文档版本: v1.0*
*创建日期: 2026-01-21*
